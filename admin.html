<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Firebase Realtime</title>

<style>
body{
    margin:0;
    font-family:Poppins, sans-serif;
    background:linear-gradient(135deg,#140f2d,#1c1340,#0f0a25);
    color:white;
}
.container{
    max-width:1000px;
    margin:auto;
    padding:20px;
}
.card{
    background:#181828;
    border:1px solid #2a2a4a;
    border-radius:15px;
    padding:20px;
    margin-bottom:20px;
}
h1{text-align:center;}
input, textarea{
    width:100%;
    box-sizing: border-box;
    padding:10px;
    margin:6px 0;
    border-radius:10px;
    border:1px solid #00f7ff;
    background:#111;
    color:white;
}
textarea{
    resize:vertical;
}
button{
    padding:8px 15px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    margin:5px 3px;
    font-weight:600;
}
.btn{
    background:linear-gradient(90deg,#00f7ff,#8a2be2);
    color:white;
}
.danger{
    background:#ff3b3b;
    color:white;
}
.status{
    font-weight:bold;
}
hr{
    border:1px solid #333;
}
</style>
</head>
<body>

<div class="container">

<h1>ðŸ›  ADMIN PANEL (FIREBASE)</h1>
<button onclick="window.location.href='https://gabut.mrjhonmc.web.id'">
â¬… Balik ke Store
</button>

<div class="card">
<h2>ðŸ“¦ Tambah Produk</h2>
<input id="name" placeholder="Nama Produk">
<textarea id="desc" rows="4" placeholder="Deskripsi"></textarea>
<input id="price" type="number" placeholder="Harga">
<button class="btn" id="btnTambah">Tambah Produk</button>
</div>

<div class="card">
<h2>ðŸ“¦ Daftar Produk</h2>
<div id="productList">Loading data...</div>
</div>

<div class="card">
<h2>ðŸ§¾ Transaksi (Masih LocalStorage)</h2>
<div id="transactionList"></div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// Sesuai gambar yang kamu kirim
const firebaseConfig = {
    apiKey: "AIzaSyDARTjARWORSxZJXpfqyA7VDLX_f0AuE8U",
    authDomain: "store-ratarasmp.firebaseapp.com",
    projectId: "store-ratarasmp",
    storageBucket: "store-ratarasmp.firebasestorage.app",
    messagingSenderId: "912001211675",
    appId: "1:912001211675:web:fe925d5d8c5676e88d07be"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// PASSWORD ADMIN
let pass = prompt("Masukkan Password Admin:");
if(pass !== "rataradev"){
    alert("Akses Ditolak!");
    window.location.href = "/";
}

// =======================
// FUNGSI TAMBAH PRODUK
// =======================
document.getElementById("btnTambah").onclick = async () => {
    let name = document.getElementById("name").value.trim();
    let desc = document.getElementById("desc").value;
    let price = parseInt(document.getElementById("price").value);

    if(!name || !desc || !price){
        alert("Isi semua data!");
        return;
    }

    try {
        await addDoc(collection(db, "produk"), {
            name: name,
            desc: desc,
            price: price,
            waktu: new Date()
        });
        
        document.getElementById("name").value="";
        document.getElementById("desc").value="";
        document.getElementById("price").value="";
    } catch (e) {
        alert("Gagal tambah produk: " + e);
    }
};

// =======================
// RENDER PRODUK (REALTIME)
// =======================
onSnapshot(collection(db, "produk"), (snapshot) => {
    let html = "";
    if (snapshot.empty) {
        html = "Belum ada produk di Cloud.";
    } else {
        snapshot.forEach((item) => {
            let p = item.data();
            let id = item.id;
            html += `
            <div style="margin-bottom:15px;">
                <input id="editName${id}" value="${p.name}">
                <textarea id="editDesc${id}" rows="4">${p.desc}</textarea>
                <input id="editPrice${id}" type="number" value="${p.price}">
                <button class="btn" onclick="saveEdit('${id}')">Simpan</button>
                <button class="danger" onclick="deleteProduct('${id}')">Hapus</button>
            </div>
            <hr>
            `;
        });
    }
    document.getElementById("productList").innerHTML = html;
});

// =======================
// EDIT & HAPUS PRODUK
// =======================
window.saveEdit = async (id) => {
    let newName = document.getElementById("editName"+id).value;
    let newDesc = document.getElementById("editDesc"+id).value;
    let newPrice = parseInt(document.getElementById("editPrice"+id).value);

    try {
        await updateDoc(doc(db, "produk", id), {
            name: newName,
            desc: newDesc,
            price: newPrice
        });
        alert("Update Berhasil!");
    } catch (e) {
        alert("Gagal update: " + e);
    }
};

window.deleteProduct = async (id) => {
    if(confirm("Yakin hapus produk ini dari Cloud?")){
        await deleteDoc(doc(db, "produk", id));
    }
};

</script>

<script>
// Transaksi sementara masih pakai kode lamamu (localStorage)
// karena kita fokus ke Produk dulu.
let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
function renderTransactions(){
    let html = transactions.length === 0 ? "Belum ada transaksi." : "";
    transactions.forEach((t,i)=>{
        let status = t.status || "ðŸŸ¡ Menunggu Admin";
        html+=`<div style="margin-bottom:15px;">
            ðŸªª ID: <b>${t.id}</b><br>
            ðŸ“¦ Produk: ${t.produk}<br>
            ðŸ“ˆ Status: <span class="status">${status}</span><br>
            <button class="danger" onclick="deleteTransaction(${i})">Hapus</button>
        </div><hr>`;
    });
    document.getElementById("transactionList").innerHTML = html;
}
function deleteTransaction(i){
    if(confirm("Hapus transaksi?")){
        transactions.splice(i,1);
        localStorage.setItem("transactions", JSON.stringify(transactions));
        renderTransactions();
    }
}
renderTransactions();
</script>
    
</body>
</html>
